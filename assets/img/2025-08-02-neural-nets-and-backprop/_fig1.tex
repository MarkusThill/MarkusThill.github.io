\documentclass{standalone}

\usepackage{amssymb}
\setcounter{tocdepth}{3}
\usepackage{graphicx}

\usepackage{url}
\urldef{\mailsa}\path|{markus.thill}@th-koeln.com|
%\urldef{\mailsb}\path|anna.kramer, leonie.kunz, christine.reiss, nicole.sator,|
%\urldef{\mailsc}\path|erika.siebert-cole, peter.strasser, lncs}@springer.com|    
\newcommand{\keywords}[1]{\par\addvspace\baselineskip
\noindent\keywordname\enspace\ignorespaces#1}

\usepackage{tikz}
\usetikzlibrary{matrix,chains,positioning,decorations.pathreplacing,arrows, shapes}
\usepackage{xifthen}
\usepackage[ngerman, english]{babel}
\usepackage{amsmath}

\newcommand{\myX}{\mathbf{x}}
\newcommand{\mySigma}{\mathbf{\Sigma}}
\newcommand{\myM}{\mathbf{M}}
\newcommand{\myT}{\mathsf{T}}

\begin{document}

\tikzset{%
  every neuron/.style={
    circle,
    draw,
    minimum size=1.1cm,
  },
	input neuron/.style={
    circle,
    draw,
    minimum size=0.8cm
  },
	tiny neuron/.style={
    circle,
    draw,
    minimum size=0.05cm
  },
  neuron missing/.style={
    draw=none, 
    scale=2,
    text height=0.333cm,
    execute at begin node=\color{black}$\vdots$
  },
	activation/.style={
		draw,
		inner sep=2pt,
		font=\Large
	},
	nothing/.style={
		draw=none
	}
}


\centering
\begin{tikzpicture}[x=1.5cm, y=1.5cm, >=stealth, scale=.8]
\scriptsize
\centering
% Input nodes
% \m = internal ID, \l = label used in a_l^0
\foreach \m/\l [count=\y] in {1/1, 2/2, 3/3, missing/, d0/d_0}
  \node [input neuron/.try, neuron \m/.try] (input-\m) at (-0.5,1.25-\y*0.85)
    {\ifthenelse{\y=4}{}{$a_{\l}^{(0)}$}};

% Draw hidden neurons 1
\foreach \m [count=\y] in {1,2,missing,d_1}
  \node [every neuron/.try, neuron \m/.try ] (hidden1-\m) at (2,2.5-\y*1.5)
    {\ifthenelse{\y=3}{}{$a_{\m}^{(1)}$}};
% Draw hidden neurons 2
\foreach \m [count=\y] in {1,2,missing,d_2}
  \node [every neuron/.try, neuron \m/.try ] (hidden2-\m) at (4.5,2.5-\y*1.5)
    {\ifthenelse{\y=3}{}{$a_{\m}^{(2)}$}};

% Draw hidden neurons 3
\foreach \m [count=\y] in {1,2,missing,d_{L-1}} 
  \node [every neuron/.try, neuron \m/.try ] (hidden3-\m) at (6.5,2.5-\y*1.5)
    {\ifthenelse{\y=3}{}{$a_{\m}^{(L-1)}$}};


% Draw output-neurons
\foreach \m [count=\y] in {1,2,missing,d_L}
  \node [input neuron/.try, neuron \m/.try ] (output-\m) at (9,2.5-\y*1.5)
    {\ifthenelse{\y=3}{}{$a_{\m}^{(L)}$}};

% Input arcs (x_l labels): map internal IDs to labels 1,2,3,d_0
\foreach \id/\lbl [count=\i] in {1/1, 2/2, 3/3, d0/d_0}
  \draw [<-] (input-\id) -- ++(-0.7,0)
    node [above, midway] {$x_{\lbl}$};

% Output arcs
\foreach \l [count=\i] in {1,2,d_L}
  \draw [->] (output-\l) -- ++(0.9,0)
    node [above, midway] {$\hat{y}_{\l}$};

% Arcs Input -> Hidden1
% \id = internal input ID, \lbl = label (1,2,3,d_0)
\foreach \id/\lbl [count=\i] in {1/1, 2/2, 3/3, d0/d_0}
  \foreach \k [count=\j] in {1,2,d_1}
    \draw [->] (input-\id) -- (hidden1-\k)
      node[pos=0.14, above=-0.02, sloped]%
      {\ifthenelse{\j=1 \AND \i=4}{$w_{\k,\lbl}^{(1)}$}{}};

\draw [->] (input-d0) -- (hidden1-d_1)
  node[pos=0.3, above=-0.02, sloped]{  $w_{d_1,d_0}^{(1)}$ } ;

\draw [->] (input-1) -- (hidden1-1)
  node[pos=0.5, above=-0.02, sloped]{ $w_{1,1}^{(1)}$ } ;
\draw [->] (input-1) -- (hidden1-2)
  node[pos=0.2, above=-0.02, sloped]{ $w_{2,1}^{(1)}$ } ;
	
% Arcs Hidden1 -> Hidden2
\foreach \i in {1,2,d_1}
  \foreach \j in {1,2,d_2}
    \draw [->] (hidden1-\i) -- (hidden2-\j);
\draw [->] (hidden1-1) -- (hidden2-1)
  node[pos=0.5, above=-0.02, sloped]{ $w_{1,1}^{(2)}$ } ;
\draw [->] (hidden1-1) -- (hidden2-2)
  node[pos=0.2, above=-0.02, sloped]{ $w_{2,1}^{(2)}$ } ;
\draw [->] (hidden1-2) -- (hidden2-2)
  node[pos=0.5, above=-0.02, sloped]{ $w_{2,2}^{(2)}$ } ;
\draw [->] (hidden1-2) -- (hidden2-d_2)
  node[pos=0.1, above=-0.02, sloped]{ $w_{d_2,2}^{(2)}$} ;
\draw [->] (hidden1-d_1) -- (hidden2-1)
  node[pos=0.2, above=-0.02, sloped]{ $w_{1,d_1}^{(2)}$ } ;
\draw [->] (hidden1-d_1) -- (hidden2-d_2)
  node[pos=0.5, above=-0.02, sloped]{ $w_{d_{2}, d_1}^{(2)}$ } ;

% Arcs Hidden2 -> nowhere (dashed fan-out)
\foreach \i in {1,2,3}
  \foreach \j in {1,2,d_2}
    \draw [dashed,->] (hidden2-\j) -- ++(0.7,0.8-0.4*\i) ;
		
% Arcs nowhere -> Hidden3 
\foreach \i in {1,...,3}
  \foreach \l [count=\j] in {1,2}
    \draw [dashed,->] ++(5.8,0.8-0.4*\i+2.5-1.5*\j) -- (hidden3-\l) ;	
\foreach \i in {1,...,3}
  \draw [dashed,->] ++(5.8,0.8-0.4*\i+2.5-1.5*4) -- (hidden3-d_{L-1}) ;

% Arcs Hidden3 -> Output
\foreach \i in {1,2,d_{L-1}}
  \foreach \j in {1,2,d_L}
    \draw [->] (hidden3-\i) -- (output-\j);
\draw [->] (hidden3-1) -- (output-1)
  node[pos=0.5, above=-0.02, sloped]{ $w_{1,1}^{(L)}$ } ;
\draw [->] (hidden3-1) -- (output-2)
  node[pos=0.2, above=-0.02, sloped]{ $w_{2,1}^{(L)}$ } ;
\draw [->] (hidden3-2) -- (output-2)
  node[pos=0.5, above=-0.02, sloped]{ $w_{2,2}^{(L)}$ } ;
\draw [->] (hidden3-2) -- (output-d_L)
  node[pos=0.15, above=-0.02, sloped]{ $w_{d_L,2}^{(L)}$} ;
\draw [->] (hidden3-d_{L-1}) -- (output-1)
  node[pos=0.2, above=-0.02, sloped]{ $w_{1,d_L-1}^{(L)}$ } ;
\draw [->] (hidden3-d_{L-1}) -- (output-d_L)
  node[pos=0.5, above=-0.02, sloped]{ $w_{d_{{L}},d_{{L}-1}}^{(L)}$ } ;

% Bias weights ell=1
\draw [->] ++(2,1.8) -- (hidden1-1)
  node[pos=0.1,left=-0.05]{ $b^{(1)}_1$ } ;
\draw [->] ++(2,0.3) -- (hidden1-2)
  node[pos=0.1,left=-0.05]{ $b^{(1)}_2$ } ;
\draw [->] ++(2,-2.7) -- (hidden1-d_1)
  node[pos=.1,left=-0.05]{ $b^{(1)}_{d_1}$ } ;
% Bias weights ell=2
\draw [->] ++(4.5,1.8) -- (hidden2-1)
  node[pos=0.1,right=-0.05]{ $b^{(2)}_1$ } ;
\draw [->] ++(4.5,0.3) -- (hidden2-2)
  node[pos=0.1,right=-0.05]{ $b^{(2)}_2$ } ;
\draw [->] ++(4.5,-2.7) -- (hidden2-d_2)
  node[pos=.1,right=-0.05]{ $b^{(2)}_{d_2}$ } ;

% Bias weights ell=L-1
\draw [->] ++(6.5,1.8) -- (hidden3-1)
  node[pos=0.1,left=-0.05]{ $b^{(L-1)}_1$ } ;
\draw [->] ++(6.5,0.3) -- (hidden3-2)
  node[pos=0.1,left=-0.05]{ $b^{(L-1)}_2$ } ;
\draw [->] ++(6.5,-2.7) -- (hidden3-d_{L-1})
  node[pos=.1,left=-0.05]{ $b^{(L-1)}_{d_{L-1}}$ } ;

% Bias weights ell=L
\draw [->] ++(9,1.8) -- (output-1)
  node[pos=0.1,right=-0.05]{ $b^{(L)}_1$ } ;
\draw [->] ++(9,0.3) -- (output-2)
  node[pos=0.1,right=-0.05]{ $b^{(L)}_2$ } ;
\draw [->] ++(9,-2.7) -- (output-d_L)
  node[pos=.1,right=-0.05]{ $b^{(L)}_{d_{L}}$ } ;
		
% Title for each layer
\node [align=center, above] at (-0.5,2) {input layer \\ $\ell=0$};
\foreach \l [count=\x from 1] in {hidden}
  \node [align=center, above] at (\x*2,2) {\l \ layer \\ $\ell=\x$};
\node [align=center, above] at (4.5,2) {hidden layer \\ $\ell=2$};
\node [align=center, above] at (6.5,2) {hidden layer \\ $\ell={L}-1$};
\node [align=center, above] at (9,2) {output layer \\ $\ell={L}$};

\end{tikzpicture}

\end{document}
