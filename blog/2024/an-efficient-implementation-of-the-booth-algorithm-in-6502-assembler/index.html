<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> A short Implementation of Booth's Multiplication Algorithm in 6502 Assembly | Markus Thill </title> <meta name="author" content="Markus Thill"> <meta name="description" content="I implemented a 6502 assembly routine for multiplying two one-byte integers using Booth's algorithm. While the algorithm itself wasn't difficult to implement, it took time to create a solution that fit within 40 lines of code. I also wrote a test routine to verify the multiplication, covering various predefined combinations, edge cases, and scenarios where one factor is zero."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%8D%95&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://markusthill.github.io/blog/2024/an-efficient-implementation-of-the-booth-algorithm-in-6502-assembler/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Markus</span> Thill </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/"> </a> </li> <li class="nav-item "> <a class="nav-link" href="/about">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/index.html">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">A short Implementation of Booth's Multiplication Algorithm in 6502 Assembly</h1> <p class="post-meta"> December 16, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/assembly-6502-booth-multiplication"> <i class="fa-solid fa-hashtag fa-sm"></i> Assembly 6502 Booth Multiplication</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Some time ago, I had to implement a multiplication routine in 6502 assembly for two integer factors, each one byte in size, using Booth’s multiplication algorithm. Implementing Booth’s method itself was not particularly tricky. However, it took me some time to come up with a solution that requires only around 40 lines of code.</p> <p>I also found it important to write a routine that tests the multiplication with various predefined combinations of the two factors. The tests included all edge cases, as well as cases where at least one of the factors is zero.</p> <p>The code I ended up with is listed below:</p> <figure class="highlight"><pre><code class="language-nasm" data-lang="nasm"><span class="c1">; A little bit shorter version of the program can be created, when using a temporary variable</span>
<span class="c1">; instead of the X-Register.</span>
<span class="nf">.ORG</span> <span class="kc">$</span><span class="mi">4000</span>
<span class="nl">main:</span>
<span class="nf">CLV</span>
<span class="nf">JSR</span> <span class="nv">bMult</span>	<span class="c1">; Perform multiplication A*B with the booth-method.</span>
<span class="nf">LDA</span> <span class="nv">R</span><span class="o">+</span><span class="mi">1</span>		<span class="c1">; Load higher-Byte of result to Accumulator.</span>
<span class="nf">LDX</span> <span class="nv">R</span>		<span class="c1">; Load lower-Byte of result to X-Register</span>
<span class="nf">RTS</span>		<span class="c1">; Stop program.</span>


<span class="nl">bMult:</span>	<span class="nf">LDA</span> <span class="nv">A</span>	<span class="c1">; Load first operand.</span>
<span class="nf">BEQ</span> <span class="nv">bMultE</span>	<span class="c1">; stop if first operand is 0.</span>
<span class="nf">STA</span> <span class="nv">R</span>		<span class="c1">; store in lower byte of result. Will be shifted out of it later.</span>
<span class="nf">ASL</span>		<span class="c1">; Determine positions where additions or subtractions have to</span>
<span class="nf">EOR</span> <span class="nv">A</span>		<span class="c1">; be performed by using XOR. For every 1 in the X-Register a</span>
<span class="nf">TAX</span>		<span class="c1">; addition or subtraction has to be performed!</span>
<span class="nf">LDY</span> <span class="err">#</span><span class="mi">8</span>		<span class="c1">; Loop-Counter</span>
<span class="nl">bLoop:</span> <span class="nf">BVS</span> <span class="nv">bOvflw</span> <span class="c1">; If B=$80 we get an overflow for the first subtraction, ignore sign!</span>
<span class="nf">LDA</span> <span class="nv">R</span><span class="o">+</span><span class="mi">1</span>		<span class="c1">; Roll Result to the right. Remember that A is in the lower Byte,</span>
<span class="nf">ASL</span>		<span class="c1">; by shifting the next A-Bit into the carry flag we can determine</span>
<span class="nl">bOvflw:</span>	<span class="nf">ROR</span> <span class="nv">R</span><span class="o">+</span><span class="mi">1</span>	<span class="c1">; later, what operation has to be performed (Addition or subtration);</span>
<span class="nf">ROR</span> <span class="nv">R</span>		<span class="c1">; The Carry-Flag first has to be saved to the stack, because it will</span>
<span class="nf">PHP</span>		<span class="c1">; be changed in the following lines. [*(1)]</span>
<span class="nf">TXA</span>		<span class="c1">; Shift X-Register to the right. By doing this we can check if any</span>
<span class="nf">LSR</span>		<span class="c1">; operation has to be performed (Addition/Subtraction). This is the</span>
<span class="nf">TAX</span>		<span class="c1">; case if the Carry-Flag is equal to 1.</span>
<span class="nf">PLA</span>		<span class="c1">; Restore Status-Register from *(1) to Accumulator.</span>
<span class="nf">BCC</span> <span class="nb">bL</span><span class="nv">oopE</span>	<span class="c1">; Branch if no addition/subtraction has to be done...</span>
<span class="nf">LSR</span>		<span class="c1">; By shifting accumulator we get the old Carry-Flag from (*1).</span>
<span class="nf">LDA</span> <span class="nv">R</span><span class="o">+</span><span class="mi">1</span>		<span class="c1">; Load result</span>
<span class="nf">BCC</span> <span class="nv">bAdd</span>	<span class="c1">; We can now decide if we have to add or subtract. Branch if we add.</span>
<span class="nf">SBC</span> <span class="nv">B</span>		<span class="c1">; Do a subtraction. We do not have to set the Carry-flag explicitly,</span>
<span class="nf">JMP</span> <span class="nv">bCont</span>	<span class="c1">; because we are sure the C-Flag is already set (based on the branch).</span>
<span class="nl">bAdd:</span> <span class="nf">ADC</span> <span class="nv">B</span>	<span class="c1">; Perform an addition. We do not have to reset the Carry-flag		</span>
<span class="nl">bCont:</span> <span class="nf">STA</span> <span class="nv">R</span><span class="o">+</span><span class="mi">1</span>	<span class="c1">; Store result of addition/subtraction.</span>
<span class="nl">bLoopE:</span> <span class="nf">DEY</span>	<span class="c1">; Decrement loop-counter.</span>
<span class="nf">BPL</span> <span class="nb">bL</span><span class="nv">oop</span>       <span class="c1">; Do loop exactly 8 times.</span>
<span class="nl">bMultE:</span> <span class="nf">RTS</span>	<span class="c1">; leave this subroutine. The result is in the variable R.</span>

<span class="nf">.ORG</span> <span class="kc">$</span><span class="mi">4500</span>
<span class="nl">A:</span> <span class="nf">.BYTE</span> <span class="kc">$</span><span class="nv">AA</span>	<span class="c1">; First factor. 1 Byte.</span>
<span class="nl">B:</span> <span class="nf">.BYTE</span> <span class="kc">$</span><span class="mi">81</span>	<span class="c1">; Second factor. 1 Byte.</span>
<span class="nl">R:</span> <span class="nf">.WORD</span> <span class="kc">$</span><span class="mi">0000</span>	<span class="c1">; The result. Needs two bytes.</span></code></pre></figure> <p>In one of the following posts I will describe the ideas behind the Booth method in more detail.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/buffer-overflows/">Stack Overflow Vulnerabilities</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/solving-peg-solitaire/">Solving Peg Solitaire with efficient Bit-Board Representations</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/soa-few-bit-twiddling-tricks/">A few Bit-Twiddling Tricks</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/a-few-properties-of-the-exclusive-or/">Some Interesting Properties of the Exclusive Or (XOR)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/the-sailors-problem/">The Monkey and Coconut Problem</a> </li> <div id="giscus_thread" style="max-width: 1000px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"MarkusThill/MarkusThill.github.io","data-repo-id":"R_kgDOLnMaxQ","data-category":"General","data-category-id":"DIC_kwDOLnMaxc4CeUxG","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Markus Thill. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a> and from <a href="https://www.freepik.com/" rel="external nofollow noopener" target="_blank">Freepik</a>. Last updated: December 18, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?5d75c11f89cd96294bf5e6dd1ee1bb30"></script> <script defer src="/assets/js/common.js?4cd9a5757c01b4f02b409c87faa45ff9"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-RPFK8PMRXH"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RPFK8PMRXH");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>